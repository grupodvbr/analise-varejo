<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Análise por Finalizadora</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f1115;
  --card:#151824;
  --border:#1f2330;
  --primary:#ff6a00;
  --success:#4cd964;
  --text:#ffffff;
  --muted:#9aa0b4;
}

*{ box-sizing:border-box; font-family:Inter,sans-serif; }

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
}

header{
  padding:20px;
  text-align:center;
  border-bottom:1px solid var(--border);
}

header h1{ margin:0; font-size:22px; }
header p{ margin-top:6px; color:var(--muted); font-size:14px; }

.wrapper{
  max-width:1200px;
  margin:20px auto;
  padding:0 16px;
}

textarea{
  width:100%;
  min-height:200px;
  background:#0b0d12;
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px;
  color:#fff;
  font-size:13px;
  resize:vertical;
}

button{
  margin-top:12px;
  background:var(--primary);
  border:none;
  color:#fff;
  padding:12px 20px;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
}

button:hover{ opacity:.9; }

.container{
  margin-top:24px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(280px,1fr));
  gap:16px;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:18px;
  cursor:pointer;
  transition:.25s;
}

.card:hover{
  transform:translateY(-4px);
  border-color:var(--primary);
}

.card-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.card-header h2{
  font-size:16px;
  margin:0;
}

.badge{
  background:#1f2330;
  padding:4px 10px;
  border-radius:20px;
  font-size:12px;
  color:var(--muted);
}

.total{
  margin-top:10px;
  font-size:22px;
  font-weight:700;
  color:var(--success);
}

.details{
  display:none;
  margin-top:12px;
  border-top:1px dashed var(--border);
  padding-top:10px;
}

.details li{
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  font-size:14px;
  border-bottom:1px solid var(--border);
}

.details li:last-child{ border:none; }

.error{
  margin-top:12px;
  color:#ff6a6a;
  font-size:14px;
}

footer{
  text-align:center;
  padding:20px;
  font-size:12px;
  color:var(--muted);
}
</style>
</head>
<body>

<header>
  <h1>Resumo por Finalizadora</h1>
  <p>Cole o JSON da API abaixo e clique em analisar</p>
</header>

<div class="wrapper">
  <textarea id="jsonInput" placeholder="Cole aqui o JSON completo da API Varejo Fácil"></textarea>
  <button onclick="analisar()">Analisar</button>
  <div id="error" class="error"></div>

  <div class="container" id="cards"></div>
</div>

<footer>
  Relatório automático • Varejo Fácil
</footer>

<script>
function analisar(){
  const error = document.getElementById("error");
  const container = document.getElementById("cards");
  error.textContent = "";
  container.innerHTML = "";

  let data;
  try{
    data = JSON.parse(document.getElementById("jsonInput").value);
  }catch(e){
    error.textContent = "❌ JSON inválido. Verifique se colou o texto completo.";
    return;
  }

  if(!data.items || !data.formasPagamento){
    error.textContent = "❌ Estrutura inválida. JSON não é da API esperada.";
    return;
  }

  const formasMap = {};
  data.formasPagamento.forEach(f => formasMap[f.id] = f.descricao);

  const agrupado = {};

  data.items.forEach(item=>{
    if(item.cancelada) return;

    item.finalizacoes.forEach(f=>{
      const id = f.finalizadoraId;
      if(!agrupado[id]){
        agrupado[id] = { nome: formasMap[id] || `Finalizadora ${id}`, total:0, valores:[] };
      }
      agrupado[id].total += f.valor;
      agrupado[id].valores.push(f.valor);
    });
  });

  Object.values(agrupado)
    .sort((a,b)=>b.total-a.total)
    .forEach(f=>{
      f.valores.sort((a,b)=>a-b);

      const card = document.createElement("div");
      card.className = "card";
card.innerHTML = `
  <div class="card-header">
    <h2>${f.nome}</h2>
    <span class="badge">${f.valores.length} lançamentos</span>
  </div>
  <div class="total">${formatBR(f.total)}</div>
  <ul class="details">
    ${f.valores.map(v=>`
      <li>
        <span>Valor</span>
        <strong>${formatBR(v)}</strong>
      </li>
    `).join("")}
  </ul>
`;


      card.onclick = () => {
        const d = card.querySelector(".details");
        d.style.display = d.style.display === "block" ? "none" : "block";
      };

      container.appendChild(card);
    });
}

function formatBR(valor){
  return new Intl.NumberFormat('pt-BR', {
    style: 'currency',
    currency: 'BRL'
  }).format(valor);
}

</script>

</body>
</html>
